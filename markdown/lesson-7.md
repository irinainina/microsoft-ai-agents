# Урок 7: Планирование дизайна

## Введение

В этом уроке мы рассмотрим:

* Определение общей цели и разбиение сложной задачи на подзадачи.
* Использование структурированного вывода для получения более надёжных и читаемых машиной ответов.
* Применение событийно-ориентированного подхода для обработки динамических задач и неожиданных входных данных.

## Цели обучения

После завершения урока вы сможете:

* Устанавливать общую цель для ИИ-агента, чётко определяя, что должно быть достигнуто.
* Разбивать сложные задачи на управляемые подзадачи и организовывать их в логической последовательности.
* Подбирать подходящие инструменты (например, поисковые или аналитические), определять, когда и как их использовать, и справляться с непредвиденными ситуациями.
* Оценивать результаты подзадач, измерять эффективность и вносить улучшения.

## Определение цели и разбиение задачи

### Формулировка цели

Большинство задач в реальном мире слишком сложны, чтобы решать их одним шагом. Агенту нужна краткая и чёткая цель. Пример:

**"Создай план поездки на 3 дня"**

На первый взгляд цель проста, но её можно уточнить: указать необходимость включить в план перелёт, бронирование отеля, предложения по активностям.

### Декомпозиция задачи

Пример подзадач для вышеуказанной цели:

* Бронирование перелёта
* Бронирование отеля
* Аренда машины
* Персонализация маршрута

Каждую подзадачу может выполнять специализированный агент. Затем центральный агент объединяет результаты.

Такой модульный подход позволяет легко добавлять новые подзадачи (например, рекомендации по питанию).

## Структурированный вывод

LLM может возвращать структурированный вывод, например, в формате JSON. Это особенно полезно для взаимодействия нескольких агентов.

Пример кода:

```python
from pydantic import BaseModel
from enum import Enum
from typing import List

class AgentEnum(str, Enum):
    FlightBooking = "flight_booking"
    HotelBooking = "hotel_booking"
    CarRental = "car_rental"
    ActivitiesBooking = "activities_booking"
    DestinationInfo = "destination_info"

class TravelSubTask(BaseModel):
    task_details: str
    assigned_agent: AgentEnum

class TravelPlan(BaseModel):
    main_task: str
    subtasks: List[TravelSubTask]
    is_greeting: bool
```

Этот шаблон позволяет чётко описать подзадачи и назначить ответственных агентов.

## Агент-планировщик и взаимодействие агентов

Пример: пользователь просит составить план поездки. Агент-планировщик:

1. Получает запрос.
2. Генерирует структурированный план.
3. Распределяет задачи между агентами.
4. Собирает и суммирует результат.

Код аналогичен предыдущему, но с реальной отправкой сообщений в API Azure.

## Итеративное планирование

Некоторые задачи требуют итеративного подхода:

* Один результат может повлиять на следующую подзадачу.
* Пользователь может вносить правки (например, сменить время вылета).

Это требует пересмотра плана и его адаптации.

Пример:

```python
UserMessage("Хочу вылет пораньше")
# Агент обновляет план с учётом предпочтений
```

## Вывод

В этом уроке мы:

* Разобрали, как определить цель и разбить её на подзадачи.
* Познакомились с примером JSON-структуры для передачи задач агентам.
* Увидели, как многократно перерабатывать план с учётом новых данных.

Всё это позволяет строить гибкие и надёжные системы на базе ИИ-агентов.
